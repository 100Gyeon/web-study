# 3. 컴퓨팅 서비스

## 01 알아둬야 할 서버 기초 지식

### 서버란

- 서버 : 네트워크에서 데이터나 서비스를 제공하는 컴퓨터
- 클라이언트 : 그 서비스를 이용하는 프로그램

### 대표적인 서버 유형

'웹 서버, 데이터베이스 서버, 메일 서버'가 있다.

#### (1) 웹 서버

> [!IMPORTANT]
> 웹 사이트를 구성하는 데 필요한 데이터를 저장하고 시스템을 제어하는 프로그램을 설치한 서버를 웹 서버라고 한다.

웹 페이지 자체의 구조를 만드는 HTML 파일과 디자인을 정의하는 CSS 파일, 사이트에 표시되는 이미지 파일 등 서비스 제공에 필요한 데이터가 저장된다.

> [!NOTE]
> AWS에서 웹 서버를 구축하는 경우, EC2와 ECS로 구현하는 경우가 많다.

#### (2) 데이터베이스 서버

> [!IMPORTANT]
> 시스템이 취급하는 데이터를 통합 관리하는 데이터베이스 관리 시스템이 설치된 서버를 데이터베이스 서버라고 한다.

데이터베이스 서버는 클라이언트에서 특정 데이터를 참조하거나 수정, 삭제 등의 데이터 처리 요구를 요청으로 받아들이고 실행 결과를 응답으로 반환한다.

> [!NOTE]
> AWS는 RDS나 DynamoDB와 같이 데이터베이스에 특화된 서비스를 제공한다.

#### (3) 메일 서버

> [!IMPORTANT]
> SMTP, POP3 프로토콜을 이용해 메일을 송신, 전달, 수신하는 서버를 메일 서버라고 한다.

SMTP 서버는 메일을 보내는 역할을 하는 서버다.  
메일 전송 요청을 받은 후 해당 메일의 수신처를 DNS 서버에서 확인해 해당 주소로 메일을 보낸다.

> [!NOTE]
> AWS에서는 EC2에 사용자가 메일 서버를 구축할 수 있다.  
> AWS 관리형 메일 전송 서비스인 Amazon SES도 있다.

### 웹 서버 작동 방식

웹 브라우저를 클라이언트로, 웹 서버를 서버로 지정해 클라이언트-서버 통신을 한다.  
이때 브라우저와 웹 서버는 HTTP/HTTPS 프로토콜로 데이터를 주고받는다.

웹 서버가 처리하는 주요 데이터
|카테고리|데이터|
|:-:|:-:|
|사이트 구성|HTML|
|사이트 레이아웃 및 디자인|CSS|
|스크립트(서버)|PHP, Ruby|
|스크립트(클라이언트)|JavaScript|
|이미지|JPEG, GIF, PNG|

### 서버 OS란

서버에도 운영체제는 반드시 탑재된다.  
서버로 이용되는 기기는 주로 리눅스나 윈도우 서버다.

### 서버 가상화

기본적으로 1대의 기기는 1개의 OS만 설치된다.  
하지만 가상화 소프트웨어를 이용하면 **하나의 하드웨어에서 여러 OS를 동작시킬 수 있다.**

- 물리 서버 = 단독 주택
- 가상 서버 = 아파트
- 하드웨어 = 건물
- OS = 가족

아파트(가상 서버)에 얼마나 많은 가족(OS)이 살 수 있는지는 건물의 크기(하드웨어)에 따라 결정된다.

### AWS에서의 가상화

AWS에서도 가상화 기술이 많이 사용된다.  
ex. Amazon Elastic Compute Cloud(EC2)

## 02 EC2로 가상 서버를 손쉽게 생성

### Amazon EC2는 가상 서버 서비스

EC2는 하드웨어와 OS가 준비된 상태로 시작하기 때문에 사용자는 OS 설정부터 실시한다.

> [!IMPORTANT]
> EC2는 가상 서버를 인스턴스 단위로 사용한다.

### 가상 서버 생성

EC2 인스턴스(가상 서버)를 생성하기 위해서는 다음 내용을 설정해야 한다.

- Amazon 머신 이미지(AMI) : OS와 소프트웨어가 설정된 템플릿
- 인스턴스 사양(인스턴스 유형) : 가상 서버의 성능 결정
- 배포할 네트워크 : 사용자가 생성한 VPC 선택
- 데이터를 저장할 스토리지 용량(EBS)
- 사용 권한 설정(보안 그룹)

생성한 인스턴스에 연결하는 방법

- SSH(리눅스) 또는 원격 데스크톱(윈도우)
- AWS Systems manager

### 인스턴스 유형으로 서버 성능 결정

[EC2 인스턴스 유형 명명 규칙](https://docs.aws.amazon.com/ko_kr/ec2/latest/instancetypes/instance-type-names.html)

인스턴스 성능은 인스턴스 유형 이름으로 알 수 있다.  
ex. `m6g.medium`

- `m` : 패밀리
  - 메모리와 CPU 중 우선시 하는 것
- `6` : 세대
  - 숫자가 클수록 성능이 좋다.
- `g` : 추가 기능
  - g는 CPU 이름인 Graviton2, n은 네트워크 강화. 추가 기능 문자가 없을 수도 있다.
- `medium` : 크기
  - 클수록 고성능이고 비싸다.

## 03 가상 서버를 안전하게 외부에 공개

### 서버 외부 공개

EC2를 인터넷에 공개하려면 충족해야 하는 3가지 조건

- EC2를 **퍼블릭 서브넷**에 배치
- **퍼블릭 IP 주소**를 EC2에 부여
- **보안 그룹**에서 외부로부터의 접근을 허가(웹 사이트라면 80번이나 443번 포트를 허가)

### 서버 접근 제어

- 인바운드 규칙 : 외부에서 EC2로의 통신
- 아웃바운드 규칙 : EC2에서 외부로의 통신

## 04 부하에 따라 서버를 자동으로 추가/삭제

**Auto Scaling** 기능을 통해 부하/접속 수/예정된 일정에 맞게 서버를 자동으로 추가/삭제할 수 있다.  
이 기능은 EC2뿐 아니라 RDS, ECS에서도 사용할 수 있다.

- 서버 추가 = Scale-out
- 서버 제거 = Scale-in

## 05 서버 없이 프로그램 실행

### 서버리스 컴퓨팅 서비스 Lambda

> [!IMPORTANT]
> 서버리스 = AWS에서 서비스가 실행될 인프라를 관리하므로 사용자가 관리할 서버가 없다는 뜻

#### 장점

- **보안** : AWS에서 모두 관리
- **비용** : EC2는 사용하지 않아도 가동하는 시간만큼 요금이 발생하지만, Lambda에서는 코드가 실행될 때만 요금 부과되므로 비용 절감 가능
- **가용성** : 복수의 가용 영역(AZ)에서 실행되어 사용자가 설정하지 않아도 고가용성, 장애 대응성 유지
- **확장성** : 동시에 다수의 처리가 필요한 경우 자동으로 AWS가 관리하는 처리용 인스턴스가 시작되면서 확장

모든 상황에 Lambda를 사용하기는 어렵다.  
설정의 유연성이 필요하거나 대량의 트래픽을 상시 처리하는 경우 더 저렴한 EC2를 선택하는 게 좋다.

### 함수 생성 및 실행

> [!IMPORTANT]
> Lambda에서는 함수 단위로 코드를 처리한다.

## 06 서버리스 활용법 이해

### AWS Lambda는 다른 서비스와 연계해 사용

#### (1) 사용자 요청에 따라 Lambda 함수 실행

**API Gateway** 서비스와 결합해 사용자의 HTTP 요청을 Lambda로 처리할 수 있다.  
사용자 ↔️ API Gateway ↔️ Lambda

#### (2) S3에 데이터를 저장할 때 자동 처리

**S3 버킷**에 저장된 데이터를 Lambda로 자동 처리할 수 있다.  
ex. S3 버킷에 저장된 데이터를 가공해 다른 S3 버킷에 저장하는 처리  
사용자 ➡️ S3 ➡️ Lambda ➡️ S3

#### (3) 주기적으로 Lambda 함수 실행

매일 정해진 시간에 어떤 처리를 하고 싶다면 **EventBridge** 서비스와 Lambda를 연계해 구현할 수 있다.  
ex. 매일 정해진 시간에 EC2를 중지하는 작업  
Event Bridge ➡️ Lambda ➡️ EC2

### AWS Lambda 추가 설정 및 모니터링

Lambda의 실행 환경은 AWS에서 관리하므로 관여하지 않아도 된다.  
원한다면 '메모리 용량, 타임아웃 시간(= 함수가 실행되는 최대 시간), 환경 변수'는 변경할 수 있다.

> [!IMPORTANT]
> Lambda에서 다른 AWS 자원을 사용하려면 권한 설정이 필요

Lambda는 S3에 데이터를 저장하거나, EC2를 시작/중지하는 등 **다른 AWS 자원을 조작하기 위한 목적**으로 사용되는 경우가 많다.  
처음 Lambda 함수를 만들면 다른 서비스에 대한 조작 권한을 따로 부여해야 한다.  
ex. S3 버킷에 데이터를 저장하는 경우, S3의 PutObject 권한을 가지는 IAM 역할을 만들어 Lambda 함수에 설정한다.

IAM 역할을 지정하지 않으면, 기본 IAM 역할이 자동으로 만들어지고 설정된다.  
기본 IAM 역할에는 CloudWatch라는 감시 서비스로 로그를 보낼 수 있는 권한만 부여된다.

Lambda 함수를 배포하면 모니터링 서비스인 Cloudwatch에서 실행 횟수, 실행 시간, 오류 수와 실행 성공률을 확인할 수 있다.

### AWS Lambda 이용 요금

EC2처럼 인스턴스 실행 시간에 대해 과금되는 것이 아니라 **요청 수와 처리 시간에 따라 청구된다.**

## 07 컨테이너의 구조와 특징 이해

### 컨테이너란

가상 서버는 아파트, 컨테이너는 셰어 하우스

어떤 응용 프로그램을 실행할지 미리 정의해둔 파일(컨테이너 이미지)을 바탕으로 컨테이너가 실행된다.  
하나의 컨테이너 이미지로 여러 개의 컨테이너를 실행할 수 있다.

### 가볍고 빠른 컨테이너

컨테이너 내에 포함된 것이 적기 때문에 가상화에 비해 가볍고 빠르다.  
가상 서버 이미지에는 OS, 미들웨어, 응용 프로그램 등이 포함되지만,  
컨테이너 이미지에는 응용 프로그램(의존성 패키지, 실행 파일)만 포함된다.

### 배포의 용이성

컨테이너 이미지는 한번 생성하면 다른 서버에서 바로 사용할 수 있다.  
즉, 개발이 끝난 이미지는 어느 환경에서 사용해도 동일한 동작을 보장한다.

컨테이너 이미지는 압축 파일 형태로 내보내거나 가져올 수 있다.  
이미지 repository를 이용해 이미지를 업로드하거나 내려받을 수도 있다.

> [!WARNING]  
> 컨테이너는 '완성된 이미지'이므로 컨테이너가 종료되면 안에 저장된 내용이 사라진다.  
> 따라서 컨테이너가 실행될 호스트 서버의 디렉터리를 마운트(연결)해서 작업 내용을 저장하는 등의 처리를 해야 한다.

### 컨테이너 오케스트레이션

각 기능을 컨테이너로 분리해 여러 컨테이너를 하나의 시스템처럼 사용하는 경우가 많다.  
이때 컨테이너를 따로 관리하지 않고 **컨테이너 오케스트레이션** 도구를 이용하면 운영 부하를 줄일 수 있다.

## 08 ECS로 누리는 컨테이너의 장점

### AWS의 컨테이너 오케스트레이션 서비스

```
AWS에서 컨테이너를 구축하는 경우 2가지 선택지
├ ECS (Elastic Container Service) : AWS의 관리형 컨테이너 오케스트레이션 서비스
│ ├─ EC2 (Elastic Compute Cloud)
│ └─ Fargate
└ EKS (Elastic Kubernetes Service)
```

ECS, EKS의 가장 큰 차이점은 **컨테이너 오케스트레이션을 AWS가 담당하느냐, 쿠버네티스가 담당하느냐**다.

### EC2와 Fargate

ECS를 이용해 컨테이너를 기동할 때 어떤 플랫폼에서 시작할지 선택할 수 있다.

선택 가능한 플랫폼 : EC2, AWS Fargate

|       구분        |                        EC2                        |                Fargate                |
| :---------------: | :-----------------------------------------------: | :-----------------------------------: |
| OS, 미들웨어 관리 |                사용자 측에서 수행                 |       PV(플랫폼 버전)에서 결정        |
| 사용자 책임 범위  | OS, 미들웨어, 컨테이너에서 실행되는 응용 프로그램 | 컨테이너에서 실행되는 응용 프로그램만 |
|    CPU, 메모리    |            인스턴스 타입 변경으로 조정            |            직접 변경 가능             |
|     스토리지      |               EBS 볼륨 크기로 조정                |    Fargate 태스크 스토리지로 조정     |

### Fargate 장점

서버 유지보수 및 관리를 AWS에서 담당하므로 편하게 ECS를 사용할 수 있다.  
Fargate가 EC2보다 약간 비싸지만, 서버 측의 관리 비용을 줄일 수 있다는 이점을 고려하면 괜찮다.

### 쿠버네티스를 보다 쉽게 사용할 수 있는 서비스

쿠버네티스는 구글에서 개발한 컨테이너 오케스트레이션 도구다.  
k8s는 구축과 그 이후의 운영에 시간과 비용이 든다는 문제가 있지만, EKS를 이용하면 이런 문제를 해결할 수 있다.

> [!TIP]
> 기본적으로 AWS에서 컨테이너를 사용해야 한다면 ECS를 이용하는 것이 가장 무난하다.  
> 하지만 구축하려는 시스템이 k8s 사용을 전제로 하는 경우라면 EKS를 사용해야 한다.
