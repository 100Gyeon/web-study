# 4. 스토리지 서비스

## [01] Amazon S3는 데이터 저장 장소

### 객체 스토리지

Amazon Simple Storage Service(S3)는 객체 스토리지 서비스다.

- 객체 : 텍스트/사진/동영상/음성 파일 같은 데이터
- 스토리지 : 데이터를 저장하는 장소
- **객체 스토리지** : 파일 스토리지처럼 폴더 구조는 갖지 않고, **객체 키로 데이터 관리**

### S3의 특징

- **용량 무제한** : 객체당 5TB라는 제약이 있지만, 객체 수나 데이터 용량에는 제한이 없다.
- **높은 내구성** : 데이터가 3개 이상의 AZ로 복사된다.
- **저렴한 비용** : 서울 리전의 표준 스토리지는 요금이 1개월당 0.025USD/GB다.

### 다른 서비스와 연계

S3는 위와 같은 장점으로 인해 **AWS의 다른 서비스와 연계해 사용**하는 경우가 많다.

- 네트워크 서비스인 VPC의 흐름 로그 저장
- CDN 서비스인 CloudFront의 접속 로그 저장
- EC2의 스토리지인 EBS의 스냅숏을 저장
- 기계 학습 서비스인 SageMaker의 입력 정보를 저장

### 요금

데이터 저장 용량, 데이터 액세스 횟수, 데이터 전송량에 따라 요금이 발생한다.

## [02] S3의 기본 용어 및 기본 조작

### S3에서 사용되는 중요 용어

#### 버킷

- 객체를 저장하는 장소
- 버킷의 이름은 모든 리전에서 고유해야 한다.

#### 객체

- 버킷에는 객체를 무제한으로 저장할 수 있다.
- 한 객체는 5TB를 넘을 수 없다.

#### 키

- 객체의 저장 URL 경로

### S3의 데이터를 브라우저나 프로그램에서 조작

데이터를 등록/삭제하는 API를 호출해 S3 객체를 조작할 수 있다.  
[콘솔](https://console.aws.amazon.com/s3)에서도 쉽게 업로드/다운로드가 가능하다.

## [03] S3 데이터를 적절하게 저장

### 사용하지 않는 객체는 저렴하게 저장

https://aws.amazon.com/ko/s3/storage-classes

S3는 비용과 가용성이 다른 여러 **스토리지 클래스**를 제공한다.  
가용성은 S3에 데이터를 업로드하거나 내려받는 등 '사용할 수 있는가 하는 관점의 수치'다.

**수명 주기 설정**이라는 기능이 있어 자동으로 스토리지 클래스 변경도 가능하다.  
하지만 저비용 스토리지 클래스로 마이그레이션하면 표준 클래스로 돌아갈 수 없다.

**Access Analyzer for S3**에서 데이터 용량과 접근 상태를 확인한 다음, 스토리지 클래스를 결정하는 것도 좋은 방법이다.  
ex. 데이터 용량이 1TB인데 접근량이 10GB라면? 데이터 용량에 비해 액세스가 적으므로 저렴한 스토리지 클래스로 변경

### 버전 관리 및 다른 리전으로 복사

S3상의 데이터는 3곳 이상으로 복사되므로 AWS로 인해 데이터가 손실되는 경우는 거의 없다.  
사용자의 실수로 데이터를 변경/삭제할 수 있으니 S3의 **버전 관리 기능**을 사용하면 좋다.  
버전 관리 설정은 S3 버킷 단위로 할 수 있다.

사용자의 실수로 인한 파일 삭제나 변경을 복구할 수 있는 편리한 기능이지만, 각 버전이 별개의 객체로 보존되기 때문에 추가 요금이 발생한다.  
수명 주기 설정을 사용해 일정 기간이 지나면 과거 버전을 자동 삭제하는 방식으로 운영할 수도 있다.

해외 리전에 데이터를 복사하는 기능도 있어 이를 활용해 데이터 내구성을 더욱 높일 수 있다.  
데이터 저장 위치와 다른 리전에 복사하는 기능을 **교차 리전 복제**(CRR-Cross Region Replication)라고 한다.

## [04] S3 데이터를 안전하게 공개

### S3 버킷에 대한 접근 제어

3가지 방법으로 접근 제어 구현

#### (1) 사용자 정책(IAM 정책)

- 'A는 버킷 검색만 가능하고 업로드는 불가'
- 사용자에 대한 권한 설정

#### (2) 접근 제어 목록(ACL)

- '데이터 A는 계정 X에 접근 허용, 데이터 B는 모든 사용자에게 접근 허용'
- 객체 또는 버킷 단위로 설정할 수 있는 접근 제어

#### (3) 버킷 설정

- 버킷 단위라고 해도 '파일 이름이 logs로 시작하는 데이터에 접근 허용, IP 주소 XX.XX.XX.XX로부터 접근 허가'와 같이 복잡한 설정 가능
- 설정은 JSON 형식으로 기재

**퍼블릭 액세스 차단**이라는 기능이 있어 의도치 않게 S3 버킷이나 객체가 공개 상태가 되는 것을 방지할 수 있다.

### S3를 이용해 웹 사이트 구축

S3의 **웹 사이트 호스팅 기능**을 활성화하면 `http://버킷이름.s3-website-리전이름.amazon.com`이라는 URL이 만들어지고, 브라우저에서 해당 URL로 접근할 수 있다.

> [!TIP]
> S3는 암호화된 통신인 HTTPS를 지원하지 않으므로 필요하다면 CDN 서비스인 CloudFront를 함께 사용해야 한다.

### 데이터 암호화

S3 관리 콘솔에서 기본 암호화 기능을 활성화하면 객체를 저장할 때 AWS에서 자동으로 암호화를 수행한다.

서버 측 암호화는 객체 저장 시 암호화이므로, 클라이언트 측 암호화를 통해 데이터 전송 중에도 데이터 보호 가능

- [서버 측 암호화](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/serv-side-encryption.html) : AWS 데이터 센터의 디스크에 저장하기 전에 S3가 객체를 암호화하고 객체를 다운로드할 때 해독
- [클라이언트 측 암호화](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/UsingClientSideEncryption.html) : 클라이언트 측에서 데이터를 암호화하여 암호화된 데이터를 S3에 업로드

## [05] 가상 서버 데이터 저장을 위한 EBS

### 서버 데이터를 저장하는 EBS

> [!IMPORTANT]
> Elastic Block Store는 EC2(가상 서버)와 함께 사용하는 스토리지 서비스다.  
> EC2 인스턴스를 생성할 때 기본적으로 하나의 EBS가 연결되며, 추가 연결도 가능하다.  
> EC2에서 실행되는 응용 프로그램의 데이터, 로그, 설정 정보 등을 저장하는 데 주로 쓰인다.

### 서버 백업 및 이미지 관리

EBS도 스토리지이므로 장애가 발생해 데이터가 파손되거나 실수로 삭제하는 등의 사고가 발생할 수 있다.  
이를 방지하기 위해 **스냅숏**이라는 **백업** 기능을 지원한다.  
스냅숏 보존에는 S3가 사용돼 저비용이면서 높은 내구성을 갖는다.

### EBS 요금

EC2와 세트로 사용되는 EBS는 용량을 확보한 순간부터 계속 요금이 발생한다.  
데이터 보존량뿐만 아니라 IOPS(읽고 쓰기 횟수)나 데이터 처리 용량에도 요금이 발생하지만, 보존에 비해 저렴하다.
